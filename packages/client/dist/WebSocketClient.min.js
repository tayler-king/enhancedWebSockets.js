!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebSocketClient=t():e.WebSocketClient=t()}(self,(function(){return(()=>{"use strict";var e={161:e=>{var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,c){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new o(r,i||e,c),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,o,i,c){var s=n?n+e:e;if(!this._events[s])return!1;var u,a,f=this._events[s],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,r),!0;case 4:return f.fn.call(f.context,t,r,o),!0;case 5:return f.fn.call(f.context,t,r,o,i),!0;case 6:return f.fn.call(f.context,t,r,o,i,c),!0}for(a=1,u=new Array(l-1);a<l;a++)u[a-1]=arguments[a];f.fn.apply(f.context,u)}else{var p,h=f.length;for(a=0;a<h;a++)switch(f[a].once&&this.removeListener(e,f[a].fn,void 0,!0),l){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,t);break;case 3:f[a].fn.call(f[a].context,t,r);break;case 4:f[a].fn.call(f[a].context,t,r,o);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];f[a].fn.apply(f[a].context,u)}}return!0},s.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||r&&s.context!==r||c(this,i);else{for(var u=0,a=[],f=s.length;u<f;u++)(s[u].fn!==t||o&&!s[u].once||r&&s[u].context!==r)&&a.push(s[u]);a.length?this._events[i]=1===a.length?a[0]:a:c(this,i)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&c(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(t,n){return function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],c=!0,s=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function f(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var l=0;function p(e){return"__private_"+l+++"_"+e}var h=n(161),y=n.n(h);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=p("options"),m=p("reconnect"),w=p("hasForceClosed"),O=p("lastMessageID"),g=p("callbacks"),j=p("webSocket"),_=p("token"),P=p("url"),S=p("createConnection"),x=p("attemptReconnection"),k=p("onSocketMessage"),E=p("onSocketClose"),A=p("onSocketError"),I=p("onSocketOpen"),C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(p,e);var t,n,r,s,l=(r=p,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=a(r);if(s){var n=a(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function p(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r=l.call(this),Object.defineProperty(i(r),I,{value:M}),Object.defineProperty(i(r),A,{value:W}),Object.defineProperty(i(r),E,{value:D}),Object.defineProperty(i(r),k,{value:T}),Object.defineProperty(i(r),x,{value:R}),Object.defineProperty(i(r),S,{value:N}),Object.defineProperty(i(r),d,{writable:!0,value:{__deprecatedEventStructure:!1,maxReconnectInterval:3e4,maxReconnectAttempts:0,reconnectInterval:1e3,timeoutInterval:2e3,reconnectDecay:1.5,reconnect:!1}}),Object.defineProperty(i(r),m,{writable:!0,value:{attemptNumber:0,timeout:!1}}),Object.defineProperty(i(r),w,{writable:!0,value:!1}),Object.defineProperty(i(r),O,{writable:!0,value:0}),Object.defineProperty(i(r),g,{writable:!0,value:new Map}),Object.defineProperty(i(r),j,{writable:!0,value:!1}),Object.defineProperty(i(r),_,{writable:!0,value:void 0}),Object.defineProperty(i(r),P,{writable:!0,value:void 0}),n&&(f(i(r),d)[d]=b(b({},f(i(r),d)[d]),n)),f(i(r),_)[_]=t,f(i(r),P)[P]=e,f(i(r),S)[S](),r}return t=p,n=[{key:"readyState",get:function(){return f(this,j)[j].readyState}},{key:"bufferedAmount",get:function(){return f(this,j)[j].bufferedAmount}},{key:"url",get:function(){return f(this,j)[j].url}},{key:"close",value:function(){var e;return f(this,w)[w]=!0,console.debug("Client manually closed WebSocket connection"),(e=f(this,j)[j]).close.apply(e,arguments)}},{key:"send",value:function(e,t,n){if("function"==typeof t&&(n=t,t=void 0),n){var r=++f(this,O)[O];return f(this,g)[g].set(r,n),f(this,j)[j].send(r+JSON.stringify([e,t]))}f(this,j)[j].send(JSON.stringify([e,t]))}}],n&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),p}(y());function N(){var e=this;console.debug("Attempting new WebSocket connection to ".concat(f(this,P)[P])),f(this,j)[j]&&(f(this,j)[j].onmessage=void 0,f(this,j)[j].onclose=void 0,f(this,j)[j].onerror=void 0,f(this,j)[j].onopen=void 0),f(this,j)[j]=new WebSocket(f(this,P)[P],f(this,_)[_]),f(this,j)[j].onmessage=function(){var t;return(t=f(e,k))[k].apply(t,arguments)},f(this,j)[j].onclose=function(){var t;return(t=f(e,E))[E].apply(t,arguments)},f(this,j)[j].onerror=function(){var t;return(t=f(e,A))[A].apply(t,arguments)},f(this,j)[j].onopen=function(){var t;return(t=f(e,I))[I].apply(t,arguments)}}function R(){var e=this,t=f(this,m)[m].attemptNumber,n=f(this,d)[d],r=n.maxReconnectInterval,o=n.maxReconnectAttempts,i=n.reconnectInterval,c=n.timeoutInterval,s=n.reconnectDecay;if(++t===o)return console.debug("Maximum connection attempts (".concat(o,") reached")),f(this,m)[m]={attemptNumber:0,timeout:!1};var u=Math.min(i*Math.pow(s,t),r);console.debug("Attempting reconnection #".concat(t," to WebSocket, delaying ").concat(u,"ms")),setTimeout((function(){f(e,S)[S](),f(e,m)[m].timeout=setTimeout((function(){console.debug("Failed to establish connection in time, closing connection"),f(e,j)[j].close()}),c)}),u),f(this,m)[m].attemptNumber=t}function T(e){var n=e.data;if(n.length){var r=function(e){var n=e.indexOf("[");if(n<0)throw new Error("Invalid message format");var r,o,i=n>0,c=+e.slice(0,n);try{var s=t(JSON.parse(e.slice(n)),2),u=s[0],a=s[1];r=u,o=a}catch(e){throw new Error("Invalid message structure")}if(i&&(Number.isNaN(c)||!Number.isInteger(c)||c<=0))throw new Error("Invalid message ID");if(!i&&("string"!=typeof r||r.length<1||r.length>64))throw new Error("Invalid event");return[c,r,o]}(n),o=t(r,3),i=o[0],c=o[1],s=o[2];if(i||!["open","close","error"].includes(c)){if(i){if(!f(this,g)[g].has(i))return;var u=f(this,g)[g].get(i);return f(this,d)[d].__deprecatedEventStructure?u({error:c,data:s}):u(c,s),f(this,g)[g].delete(i)}this.onmessage?this.onmessage(c,s):this.emit(c,s)}}}function D(e){if(clearTimeout(f(this,m)[m].timeout),console.debug("WebSocket connection lost"),f(this,g)[g].forEach((function(e){e("Socket closed")})),f(this,g)[g].clear(),f(this,O)[O]=0,!f(this,w)[w]&&f(this,d)[d].reconnect){if(f(this,m)[m].attemptNumber)return f(this,x)[x]();f(this,x)[x]()}f(this,w)[w]=!1,this.onclose?this.onclose(e):this.emit("close",e)}function W(e){this.onerror?this.onerror(e):this.emit("error",e)}function M(e){clearTimeout(f(this,m)[m].timeout),console.debug("WebSocket connection established"),f(this,w)[w]=!1,f(this,m)[m]={attemptNumber:0,timeout:!1},this.onopen?this.onopen(e):this.emit("open",e)}"undefined"!=typeof window&&(window.WebSocketClient=C)})(),r.default})()}));