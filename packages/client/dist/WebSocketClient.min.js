!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebSocketClient=t():e.WebSocketClient=t()}(self,(function(){return(()=>{var e={742:e=>{var t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},161:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,c){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new o(r,i||e,c),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,o,i,c){var s=n?n+e:e;if(!this._events[s])return!1;var u,a,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,o),!0;case 5:return l.fn.call(l.context,t,r,o,i),!0;case 6:return l.fn.call(l.context,t,r,o,i,c),!0}for(a=1,u=new Array(f-1);a<f;a++)u[a-1]=arguments[a];l.fn.apply(l.context,u)}else{var p,h=l.length;for(a=0;a<h;a++)switch(l[a].once&&this.removeListener(e,l[a].fn,void 0,!0),f){case 1:l[a].fn.call(l[a].context);break;case 2:l[a].fn.call(l[a].context,t);break;case 3:l[a].fn.call(l[a].context,t,r);break;case 4:l[a].fn.call(l[a].context,t,r,o);break;default:if(!u)for(p=1,u=new Array(f-1);p<f;p++)u[p-1]=arguments[p];l[a].fn.apply(l[a].context,u)}}return!0},s.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||r&&s.context!==r||c(this,i);else{for(var u=0,a=[],l=s.length;u<l;u++)(s[u].fn!==t||o&&!s[u].once||r&&s[u].context!==r)&&a.push(s[u]);a.length?this._events[i]=1===a.length?a[0]:a:c(this,i)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&c(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},731:(e,t,n)=>{var r;if("object"==typeof globalThis)r=globalThis;else try{r=n(742)}catch(e){}finally{if(r||"undefined"==typeof window||(r=window),!r)throw new Error("Could not determine global this")}var o=r.WebSocket||r.MozWebSocket,i=n(755);function c(e,t){return t?new o(e,t):new o(e)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(c,e,{get:function(){return o[e]}})})),e.exports={w3cwebsocket:o?c:null,version:i}},755:(e,t,n)=>{e.exports=n(735).version},735:e=>{"use strict";e.exports={version:"1.0.34"}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(t,n){return function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],c=!0,s=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function l(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var f=0;function p(e){return"__private_"+f+++"_"+e}var h=n(161),y=n.n(h),b=n(731);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=p("options"),w=p("reconnect"),g=p("hasForceClosed"),O=p("lastMessageID"),j=p("callbacks"),_=p("webSocket"),P=p("token"),S=p("url"),x=p("createConnection"),k=p("attemptReconnection"),E=p("onSocketMessage"),C=p("onSocketClose"),N=p("onSocketError"),I=p("onSocketOpen"),T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(p,e);var t,n,r,s,f=(r=p,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=a(r);if(s){var n=a(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function p(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r=f.call(this),Object.defineProperty(i(r),I,{value:L}),Object.defineProperty(i(r),N,{value:M}),Object.defineProperty(i(r),C,{value:W}),Object.defineProperty(i(r),E,{value:D}),Object.defineProperty(i(r),k,{value:R}),Object.defineProperty(i(r),x,{value:A}),Object.defineProperty(i(r),m,{writable:!0,value:{__deprecatedEventStructure:!1,maxReconnectInterval:3e4,maxReconnectAttempts:0,reconnectInterval:1e3,timeoutInterval:2e3,reconnectDecay:1.5,reconnect:!1}}),Object.defineProperty(i(r),w,{writable:!0,value:{attemptNumber:0,timeout:!1}}),Object.defineProperty(i(r),g,{writable:!0,value:!1}),Object.defineProperty(i(r),O,{writable:!0,value:0}),Object.defineProperty(i(r),j,{writable:!0,value:new Map}),Object.defineProperty(i(r),_,{writable:!0,value:!1}),Object.defineProperty(i(r),P,{writable:!0,value:void 0}),Object.defineProperty(i(r),S,{writable:!0,value:void 0}),n&&(l(i(r),m)[m]=d(d({},l(i(r),m)[m]),n)),l(i(r),P)[P]=t,l(i(r),S)[S]=e,l(i(r),x)[x](),r}return t=p,n=[{key:"readyState",get:function(){return l(this,_)[_].readyState}},{key:"bufferedAmount",get:function(){return l(this,_)[_].bufferedAmount}},{key:"url",get:function(){return l(this,_)[_].url}},{key:"close",value:function(){var e;return l(this,g)[g]=!0,console.debug("Client manually closed WebSocket connection"),(e=l(this,_)[_]).close.apply(e,arguments)}},{key:"send",value:function(e,t,n){if("function"==typeof t&&(n=t,t=void 0),n){var r=++l(this,O)[O];return l(this,j)[j].set(r,n),l(this,_)[_].send(r+JSON.stringify([e,t]))}l(this,_)[_].send(JSON.stringify([e,t]))}}],n&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),p}(y());function A(){var e=this;console.debug("Attempting new WebSocket connection to ".concat(l(this,S)[S])),l(this,_)[_]&&(l(this,_)[_].onmessage=void 0,l(this,_)[_].onclose=void 0,l(this,_)[_].onerror=void 0,l(this,_)[_].onopen=void 0),l(this,_)[_]=new b.w3cwebsocket(l(this,S)[S],l(this,P)[P]),l(this,_)[_].onmessage=function(){var t;return(t=l(e,E))[E].apply(t,arguments)},l(this,_)[_].onclose=function(){var t;return(t=l(e,C))[C].apply(t,arguments)},l(this,_)[_].onerror=function(){var t;return(t=l(e,N))[N].apply(t,arguments)},l(this,_)[_].onopen=function(){var t;return(t=l(e,I))[I].apply(t,arguments)}}function R(){var e=this,t=l(this,w)[w].attemptNumber,n=l(this,m)[m],r=n.maxReconnectInterval,o=n.maxReconnectAttempts,i=n.reconnectInterval,c=n.timeoutInterval,s=n.reconnectDecay;if(++t===o)return console.debug("Maximum connection attempts (".concat(o,") reached")),l(this,w)[w]={attemptNumber:0,timeout:!1};var u=Math.min(i*Math.pow(s,t),r);console.debug("Attempting reconnection #".concat(t," to WebSocket, delaying ").concat(u,"ms")),setTimeout((function(){l(e,x)[x](),l(e,w)[w].timeout=setTimeout((function(){console.debug("Failed to establish connection in time, closing connection"),l(e,_)[_].close()}),c)}),u),l(this,w)[w].attemptNumber=t}function D(e){var n=e.data;if(n.length){var r=function(e){var n=e.indexOf("[");if(n<0)throw new Error("Invalid message format");var r,o,i=n>0,c=+e.slice(0,n);try{var s=t(JSON.parse(e.slice(n)),2),u=s[0],a=s[1];r=u,o=a}catch(e){throw new Error("Invalid message structure")}if(i&&(Number.isNaN(c)||!Number.isInteger(c)||c<=0))throw new Error("Invalid message ID");if(!i&&("string"!=typeof r||r.length<1||r.length>64))throw new Error("Invalid event");return[c,r,o]}(n),o=t(r,3),i=o[0],c=o[1],s=o[2];if(i||!["open","close","error"].includes(c)){if(i){if(!l(this,j)[j].has(i))return;var u=l(this,j)[j].get(i);return l(this,m)[m].__deprecatedEventStructure?u({error:c,data:s}):u(c,s),l(this,j)[j].delete(i)}this.onmessage?this.onmessage(c,s):this.emit(c,s)}}}function W(e){if(clearTimeout(l(this,w)[w].timeout),console.debug("WebSocket connection lost"),l(this,j)[j].forEach((function(e){e("Socket closed")})),l(this,j)[j].clear(),l(this,O)[O]=0,!l(this,g)[g]&&l(this,m)[m].reconnect){if(l(this,w)[w].attemptNumber)return l(this,k)[k]();l(this,k)[k]()}l(this,g)[g]=!1,this.onclose?this.onclose(e):this.emit("close",e)}function M(e){this.onerror?this.onerror(e):this.emit("error",e)}function L(e){clearTimeout(l(this,w)[w].timeout),console.debug("WebSocket connection established"),l(this,g)[g]=!1,l(this,w)[w]={attemptNumber:0,timeout:!1},this.onopen?this.onopen(e):this.emit("open",e)}"undefined"!=typeof window&&(window.WebSocketClient=T)})(),r.default})()}));